<script lang='ts'>
    import type { DatabaseTodo } from '$lib/database/interfaces';


    import {
        removeTodo,
        completeTodo,
    } from '$lib/utils/index';


    export let todoList : DatabaseTodo[];
    export let todo : DatabaseTodo;
    export let updateTodoList : (list : DatabaseTodo[]) => void;



    // Removes the clicked todo
    async function remove(todoId: string) : Promise<void> {

        const response = await fetch(`/api/todos/${todoId}`, {method: 'DELETE'})

        if (!await response.json())
            return;
        
        updateTodoList(
            removeTodo(todoList, todoId)
        );

    }

    // Marks the clicked todo as completed
    async function complete(todoId: string) : Promise<void> {

        const response = await fetch(`/api/todos/${todoId}`, {
            method: 'PUT',
            body:JSON.stringify({
                complete: !todo.isDone
            })
        });
        
        if (!await response.json())
            return
        
        todo.isDone = !todo.isDone;
        updateTodoList(todoList);

    }


</script>





<li class="todo-item {todo.isDone ? 'completed' : ''}">

    <div class="left-content">
        <button class="complete-button non-selectable" onclick={ () => complete(todo._id.toString())}> ‚úÖ </button>
        <span class="todo-text"> {todo.text} </span>
    </div>

    <button class="delete-button non-selectable" onclick={ () => remove(todo._id.toString()) }> üóëÔ∏è </button>
</li>






<style>
    .non-selectable {
        user-select: none; /* Standard syntax */
        -webkit-user-select: none; /* Safari */
        -moz-user-select: none; /* Firefox */
        -ms-user-select: none; /* Internet Explorer/Edge */
    }

    .todo-item {
        font-family: 'Futura', sans-serif;
        background-color: rgba(249, 249, 249, 0.5);
        border: 1px solid #ddd;
        border-radius: 10px;
        padding: 10px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: background-color 0.3s ease, transform 0.2s ease;
    }

    .left-content {
        display: flex;
        align-items: center;
    }

    .todo-text {
        text-align: justify;
        padding-left: 15px;
        padding-right: 15px;
    }

    .todo-item.completed span {
        text-decoration: line-through;
        color: #999;
    }

    .complete-button, .delete-button {
        background: none;
        border: 2px solid;
        color: white;
        padding: 5px 10px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 14px;
        font-weight: bold;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: background 0.3s ease, transform 0.2s ease;
    }

    .complete-button {
        background: none;
        border: none;
        padding: 10px 10px;
        border-radius: 100%;
        cursor: pointer;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease;
    }

    .complete-button:hover {
        background: linear-gradient(135deg, rgba(72, 220, 126, 0.8), #FFFFFF);
        color: white;
        transform: scale(102.5%);
    }

    .complete-button:active {
        transform: scale(97.5%);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .delete-button {
        background: none;
        border: none;
        padding: 10px 10px;
        border-radius: 10px;
        cursor: pointer;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease;
    }

    .delete-button:hover {
        background: linear-gradient(315deg, rgba(205,0,0, 0.6), #FFFFFF);
        color: white;
        transform: scale(102.5%);
    }

    .delete-button:active {
        transform: scale(97.5%);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
</style>
